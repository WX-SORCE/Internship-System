# Risk Service 项目文档

Risk Service 基于 Spring Boot 开发，面向金融场景，旨在对客户风险进行准确评估与管理。项目集成多项前沿技术，提供高效、安全的风险评估解决方案。

## 1. 服务概述

Risk Service 是一个基于 Spring Boot 的 Java 项目，借助 Spring 生态体系的强大功能，实现风险评估信息管理、KYC（了解你的客户）、风险评估等关键功能，帮助金融机构更好地管控风险，合规开展业务。

## 2. 业务逻辑

### 2.1 初评流程

客户完成注册后，系统自动启动初评流程。客户提交评估表单，数据保存至数据库表。风控人员在评估表单列表，选择需审核的表单，提交审核意见。系统根据客户评估表单数据进行逻辑计算，得出评估得分、风险等级等数据，并保存至风险评估表。同时，调用 client-service 接口，发送客户风险等级等数据更新通知。

### 2.2 复评流程

系统通过定时任务检索 6 个月到期客户，调用 notification-service 接口，向客户发送复评消息。复评流程与初评基本一致，不同在于复评结果更新至现有评估表，客户之前的评估结果保存至历史表。

## 3. 工作内容

### 3.1 模块设计与实现

项目整体采用经典的分层架构设计，各模块职责明确，相互协作。

#### 3.1.1 控制模块

提供风险评估列表查询接口，支持模糊查询与条件查询，以及评估信息的列表查询、保存和审核接口。负责处理客户端 HTTP 请求，调用相应服务层方法执行业务逻辑，将处理结果封装成统一响应对象返回给客户端。

#### 3.1.2 服务模块

实现风险评估分页查询功能，支持排序和分页参数设置，同样提供评估信息的分页查询、保存和审核功能。分页查询时，依据请求参数设置排序和分页信息，调用数据访问接口的findAll方法查询数据。保存和更新业务数据时，调用数据访问接口的save方法，将数据持久化到数据库。审核业务根据审核结果，调用评估功能更新评估结果。

#### 3.1.3 数据访问模块

使用 Spring Data JPA 定义数据访问接口，为 RiskAssessment、RiskAssessmentHistory 实体提供 CRUD 操作，同时支持对 AssessmentInfo 实体的数据访问，简化数据库操作，提高开发效率。

#### 3.1.4 日志模块

在多线程环境下传递 MDC（Mapped Diagnostic Context）信息，方便记录日志。通过 AOP 记录请求和响应信息，包括请求头、请求参数、响应耗时和响应消息，便于排查和分析系统运行过程中的问题。

#### 3.1.5 异常处理模块

处理@RequestParam和@PathVariable参数校验异常，返回统一的错误响应，保证系统错误处理的一致性和友好性。

### 3.2 前后端配合

积极配合前端开发人员，实现页面业务逻辑。双方通过接口文档进行沟通，确保前后端数据交互的准确性和稳定性，共同打造用户体验良好的风险评估系统。

## 4. 项目结构

```
risk-service/
├── pom.xml                          # Maven项目对象模型文件，管理项目依赖和构建配置
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/
│   │   │       └── hsbc/
│   │   │           └── pws/
│   │   │               ├── common/
│   │   │               │   ├── exception/ # 异常处理相关类
│   │   │               │   ├── log/       # 日志相关类
│   │   │               │   └── utils/     # 工具类
│   │   │               ├── risk/
│   │   │               │   ├── controller/ # 控制层
│   │   │               │   ├── entity/     # 实体类
│   │   │               │   ├── pojo/       # 数据传输对象
│   │   │               │   ├── repository/ # 数据访问层
│   │   │               │   └── service/    # 服务层
│   │   │               └── RiskServerApplication.java # 项目启动类
│   │   └── resources/
│   │       └── application.yml        # 配置文件，存放项目配置信息
│   └── test/
│       └── java/
│           └── com/
│               └── hsbc/
│                   └── pws/            # 测试代码目录
```

## 5. 技术栈

| 技术                | 版本          | 说明                                           |
| ------------------- | ------------- | ---------------------------------------------- |
| Java                | Java 17       | 项目开发语言，提供强大的性能和丰富的类库       |
| Spring Boot         | 3.4.3         | 快速搭建项目的开发框架，简化 Spring 应用开发   |
| Spring Cloud        | 2024.0.1      | 微服务开发框架，提供服务注册、发现、熔断等功能 |
| Spring Cloud Eureka | 1.4.7.RELEASE | 服务注册与发现组件                             |
| MySQL               | 8.3.0         | 关系型数据库，存储项目数据                     |
| 链接池              | Druid 1.2.24  | 数据库连接池，提高数据库访问性能               |
| Spring Data JPA     | 3.4.3         | 简化数据库访问操作，实现对象关系映射           |

## 6. 配置信息

### 6.1 服务端口与名称

在application.yml中，通过server.port配置服务启动端口号为 9006，通过spring.application.name指定服务名称为 risk-service。

### 6.2 Eureka 配置

通过eureka.client.service-url.defaultZone指定 Eureka 服务注册中心地址，实现服务的注册与发现。

### 6.3 数据库配置

在application.yml中配置 MySQL 数据库连接信息，包括数据库地址、端口、用户名、密码等，确保项目与数据库的正常连接。

### 6.4 日志配置

配置日志文件路径和日志级别，方便记录和管理系统运行日志，有助于排查问题和监控系统状态。

## 7. 服务依赖

- **Eureka 服务**：确保 Eureka 服务已启动，且application.yml中配置的defaultZone地址正确，使 Risk Service 能够注册到 Eureka 服务注册中心。

- **client-service 服务**：确保 client-service 服务已启动，并注册到 discovery-service，以便 Risk Service 调用其接口发送客户风险等级等数据更新通知。

- **notification-service 服务**：确保 notification-service 服务已启动，并注册到 discovery-service，以便 Risk Service 调用其接口发送复评消息。

## 8. 使用指南

### 8.1 启动服务

在项目根目录执行mvn spring-boot:run命令，启动 Risk Service。

### 8.2 接口调用

通过 Postman 等工具，按照接口文档说明，向 Risk Service 发送 HTTP 请求，进行风险评估信息查询、保存、审核等操作。

### 8.3 日志查看

查看配置的日志文件，了解系统运行情况，排查可能出现的问题。

